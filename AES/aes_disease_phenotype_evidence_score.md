# Advanced Explanation System (AES)
*Therapeutic Strategy: Disease associated with Phenotype workflow*

## 1. Background
The AES is one means by which the Explanatory Agent provides the ability to evaluate, order, and organize Translator Knowledge Provider (KP) assertions i.e., subject-predicate-object triples returned by one or more KPs. Specifically, AES involves an independent querying system, congruent to Translator KP queries, which provides corroborating assertions for comparison. Furthermore, AES provides vectorized encodings of biochemical and biomedical entity properties (e.g., proteins, chemicals, and phenotypes), are used to score Translator results by virtue of their similarity to AES-derived results. This strategy evaluates the extent to which translator responses are consistent with independently obtained answers to a query, and to which the properties of those answers align with known associations.
## 2. AES query workflow description
When the Explanatory Agent receives a query related to the identification of phenotypes associated with diseases, it triggers a process hosted at Tufts Analytics Platform (TAP) which performs a deep phenotyping subroutine that identifies significant comorbid conditions shared among patients diagnosed with the input disease. This involves direct querying of live, real-world patient records  from [Tufts Clinical Data Warehouse (TCDW)](https://www.tuftsctsi.org/research-services/informatics/tufts-medical-center-research-data-warehouse/)  using semantic vocabularies and clinical codes defined in the Observational Health Data Sciences and Informatics [(OHDSI) Observational Medical Outcomes Partnership (OMOP) Common Data Model](https://www.ohdsi.org/data-standardization/).  At the end of this process, comorbid conditions are listed and converted into Biolink compliant ontology terms, which serve as the AES-derived phenotype answers to the query. 
##	3. AES feature engineering process
Concurrently, TAP also creates a matrix of engineered features for phenotypes and places these into an adjacency matrix for profiling. In this case, each phenotypic feature profile is represented as a Boolean vector of the diseases in which they occur, queried from the [Monarch Initiative’s Neo4j graph](https://doi.org/10.1093/nar/gkz997). To summarize, this matrix has rows representing every phenotype term from the Human Phenotype Ontology and columns representing every disease term in the MONDO disease ontology. A 1 is placed in each Boolean vector for known phenotype-disease associations in the Monarch Initiative database.
##	4. Answer scoring
After KPs return responses for the input query and after AES completes its deep phenotyping workflow and produces congruent responses, the phenotype responses from each are mapped to the ontology term represented in the rows of the feature vector matrix described in section 3 (in this case an HPO term) and a subset of the matrix is filtered for each set of phenotypes obtained from KPs and AES to produce two adjacency matrices of phenotype vectors. 

For each phenotype (row) in the KP-produced matrix, a cosine similarity is computed against the entire AES-produced matrix. The resulting KP phenotype vector is a list of cosine scores indicating how consistently each feature (disease) was shared among all AES-identified phenotype-disease associations. An average cosine score is then obtained for each KP phenotype result and returned as the score for consistency in the Explanatory Agent’s response. 
